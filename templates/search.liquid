{% comment %}
  Enhanced Search Results Template
  Optimized for RecoverSups supplement search experience
{% endcomment %}

<div class="search-template">
  <div class="search-header">
    <h1 class="search-title">
      {% if search.terms %}
        Resultados para "{{ search.terms }}"
      {% else %}
        Buscar Productos
      {% endif %}
    </h1>
    
    {% if search.terms %}
      <p class="search-subtitle">
        {% if search.results_count == 0 %}
          No se encontraron resultados para "{{ search.terms }}"
        {% elsif search.results_count == 1 %}
          1 resultado encontrado
        {% else %}
          {{ search.results_count }} resultados encontrados
        {% endif %}
      </p>
    {% endif %}
  </div>

  <div class="search-form">
    <form action="{{ routes.search_url }}" method="get" class="search-form__form" role="search">
      <div class="search-form__input-wrapper">
        <input
          type="search"
          name="q"
          value="{{ search.terms | escape }}"
          placeholder="Buscar suplementos, proteínas, vitaminas..."
          class="search-form__input"
          autocomplete="off"
          aria-label="Buscar productos"
          id="search-page-input"
        >
        <button type="submit" class="search-form__button btn btn-primary">
          <span>Buscar</span>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/>
            <path d="m21 21-4.35-4.35"/>
          </svg>
        </button>
      </div>
    </form>
  </div>

  {% if search.performed %}
    <div class="search-results">
      {% if search.results_count == 0 %}
        <div class="search-results__empty">
          <div class="search-empty-state">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"/>
              <path d="m21 21-4.35-4.35"/>
            </svg>
            <h3>No se encontraron resultados</h3>
            <p>No encontramos productos que coincidan con "{{ search.terms }}". Intenta con otros términos o revisa nuestras categorías populares.</p>
            
            <div class="search-suggestions">
              <p><strong>Sugerencias:</strong></p>
              <div class="search-suggestions__list">
                <a href="{{ routes.search_url }}?q=proteína" class="search-suggestion-btn">Proteína</a>
                <a href="{{ routes.search_url }}?q=creatina" class="search-suggestion-btn">Creatina</a>
                <a href="{{ routes.search_url }}?q=vitaminas" class="search-suggestion-btn">Vitaminas</a>
                <a href="{{ routes.search_url }}?q=pre+entreno" class="search-suggestion-btn">Pre Entreno</a>
              </div>
            </div>
          </div>
        </div>
      {% else %}
        <!-- Search Filters -->
        <div class="search-filters">
          <div class="search-filters__header">
            <span class="search-filters__title">Filtrar por:</span>
          </div>
          <div class="search-filters__buttons">
            <a href="{{ routes.search_url }}?q={{ search.terms | escape }}" class="search-filter-btn {% unless request.params.type %}active{% endunless %}">
              <span>Todo ({{ search.results_count }})</span>
            </a>
            <a href="{{ routes.search_url }}?q={{ search.terms | escape }}&type=product" class="search-filter-btn {% if request.params.type == 'product' %}active{% endif %}">
              <span>Productos</span>
            </a>
            <a href="{{ routes.search_url }}?q={{ search.terms | escape }}&type=page" class="search-filter-btn {% if request.params.type == 'page' %}active{% endif %}">
              <span>Páginas</span>
            </a>
            <a href="{{ routes.search_url }}?q={{ search.terms | escape }}&type=article" class="search-filter-btn {% if request.params.type == 'article' %}active{% endif %}">
              <span>Artículos</span>
            </a>
          </div>
        </div>

        <!-- Search Results Grid -->
        <div class="search-results__grid">
          {% for item in search.results %}
            <div class="search-result search-result--{{ item.object_type }}">
              {% case item.object_type %}
                {% when 'product' %}
                  <a href="{{ item.url }}" class="search-result__link">
                    {% if item.featured_media %}
                      <div class="search-result__image">
                        <img 
                          src="{{ item.featured_media | image_url: width: 300, height: 300 }}"
                          alt="{{ item.featured_media.alt | escape | default: item.title }}"
                          width="300"
                          height="300"
                          loading="lazy"
                        >
                      </div>
                    {% endif %}
                    <div class="search-result__content">
                      <span class="search-result__type">Producto</span>
                      <h3 class="search-result__title">{{ item.title }}</h3>
                      {% if item.price %}
                        <div class="search-result__price">{{ item.price | money }}</div>
                      {% endif %}
                      {% if item.vendor %}
                        <div class="search-result__vendor">{{ item.vendor }}</div>
                      {% endif %}
                      <span class="search-result__availability {% if item.available %}available{% else %}unavailable{% endif %}">
                        {% if item.available %}Disponible{% else %}Agotado{% endif %}
                      </span>
                    </div>
                  </a>
                  
                {% when 'collection' %}
                  <a href="{{ item.url }}" class="search-result__link">
                    {% if item.featured_image %}
                      <div class="search-result__image">
                        <img 
                          src="{{ item.featured_image | image_url: width: 300, height: 300 }}"
                          alt="{{ item.title }}"
                          width="300"
                          height="300"
                          loading="lazy"
                        >
                      </div>
                    {% endif %}
                    <div class="search-result__content">
                      <span class="search-result__type">Categoría</span>
                      <h3 class="search-result__title">{{ item.title }}</h3>
                      <div class="search-result__description">{{ item.description | strip_html | truncate: 120 | default: 'Ver productos en esta categoría' }}</div>
                    </div>
                  </a>
                  
                {% when 'page' %}
                  <a href="{{ item.url }}" class="search-result__link">
                    <div class="search-result__content">
                      <span class="search-result__type">Página</span>
                      <h3 class="search-result__title">{{ item.title }}</h3>
                      <div class="search-result__description">{{ item.content | strip_html | truncate: 120 }}</div>
                    </div>
                  </a>
                  
                {% when 'article' %}
                  <a href="{{ item.url }}" class="search-result__link">
                    {% if item.image %}
                      <div class="search-result__image">
                        <img 
                          src="{{ item.image | image_url: width: 300, height: 300 }}"
                          alt="{{ item.title }}"
                          width="300"
                          height="300"
                          loading="lazy"
                        >
                      </div>
                    {% endif %}
                    <div class="search-result__content">
                      <span class="search-result__type">Artículo</span>
                      <h3 class="search-result__title">{{ item.title }}</h3>
                      <div class="search-result__description">{{ item.excerpt | strip_html | truncate: 120 | default: item.content | strip_html | truncate: 120 }}</div>
                      {% if item.author %}
                        <div class="search-result__author">Por {{ item.author }}</div>
                      {% endif %}
                    </div>
                  </a>
              {% endcase %}
            </div>
          {% endfor %}
        </div>

        <!-- Pagination -->
        {% if paginate.pages > 1 %}
          <div class="search-pagination">
            {% render 'pagination', paginate: paginate %}
          </div>
        {% endif %}
      {% endif %}
    </div>
  {% else %}
    <!-- No search performed yet -->
    <div class="search-suggestions">
      <div class="search-suggestions__header">
        <span class="search-suggestions__title">Búsquedas populares</span>
      </div>
      <div class="search-suggestions__list">
        <a href="{{ routes.search_url }}?q=proteína+whey" class="search-suggestion-btn">Proteína Whey</a>
        <a href="{{ routes.search_url }}?q=creatina" class="search-suggestion-btn">Creatina</a>
        <a href="{{ routes.search_url }}?q=aminoácidos" class="search-suggestion-btn">Aminoácidos</a>
        <a href="{{ routes.search_url }}?q=vitaminas" class="search-suggestion-btn">Vitaminas</a>
        <a href="{{ routes.search_url }}?q=pre+entreno" class="search-suggestion-btn">Pre Entreno</a>
        <a href="{{ routes.search_url }}?q=quemador+grasa" class="search-suggestion-btn">Quemador de Grasa</a>
        <a href="{{ routes.search_url }}?q=mass+gainer" class="search-suggestion-btn">Mass Gainer</a>
        <a href="{{ routes.search_url }}?q=omega+3" class="search-suggestion-btn">Omega 3</a>
      </div>
    </div>
  {% endif %}
</div>

<script>
  // Enhanced search page functionality
  document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('search-page-input');
    if (searchInput) {
      // Auto-focus on search input
      searchInput.focus();
      
      // Select all text if there's a value
      if (searchInput.value) {
        searchInput.select();
      }
      
      // Enhanced search suggestions
      const suggestionBtns = document.querySelectorAll('.search-suggestion-btn');
      suggestionBtns.forEach(btn => {
        btn.addEventListener('click', function(e) {
          if (this.dataset.query) {
            e.preventDefault();
            searchInput.value = this.dataset.query;
            searchInput.closest('form').submit();
          }
        });
      });
    }
  });
</script>