{% comment %}
  Homepage template for Shopify
  Includes all sections from the original Next.js page
{% endcomment %}

{% liquid
  assign page_title = shop.name
  assign page_description = shop.description | default: 'Premium supplements and fitness products for your health journey'
  assign canonical_url = shop.url
%}

{% comment %} Skip to main content for accessibility {% endcomment %}
<a href="#main-content" class="skip-link visually-hidden">Skip to main content</a>

{% comment %} Breadcrumb Navigation {% endcomment %}
<nav aria-label="Breadcrumb" class="breadcrumb-nav">
  <ol class="breadcrumb-list">
    <li class="breadcrumb-item">
      <a href="{{ routes.root_url }}" class="breadcrumb-link">
        <span>Home</span>
      </a>
    </li>
  </ol>
</nav>

{% comment %} Main Content Area {% endcomment %}
<main id="main-content" class="main-content" role="main">
  
  {% comment %} Hero Carousel Section {% endcomment %}
  <section id="hero-carousel" class="hero-section" aria-label="Hero Carousel">
    {% section 'hero-carousel' %}
  </section>
  
  {% comment %} Product Categories Section {% endcomment %}
  <section id="product-categories" class="categories-section" aria-label="Product Categories">
    {% section 'product-categories' %}
  </section>
  
  {% comment %} Featured Products Section {% endcomment %}
  <section id="featured-products" class="featured-section" aria-label="Featured Products">
    {% section 'featured-products' %}
  </section>
  
  {% comment %} Collection Banners Section {% endcomment %}
  <section id="collection-banners" class="banners-section" aria-label="Collection Banners">
    {% section 'collection-banners' %}
  </section>
  
  {% comment %} Trending Products Section {% endcomment %}
  <section id="trending-products" class="trending-section" aria-label="Trending Products">
    {% section 'trending-products' %}
  </section>
  
  {% comment %} Why Choose Us Section {% endcomment %}
  <section id="why-choose-us" class="features-section" aria-label="Why Choose Us">
    {% section 'why-choose-us' %}
  </section>
  
  {% comment %} Exclusive Offer Section {% endcomment %}
  <section id="exclusive-offer" class="offer-section" aria-label="Exclusive Offer">
    {% section 'exclusive-offer' %}
  </section>
  
  {% comment %} Customer Testimonials Section {% endcomment %}
  <section id="testimonials" class="testimonials-section" aria-label="Customer Testimonials">
    {% section 'testimonials' %}
  </section>
  
  {% comment %} Recent Blogs Section {% endcomment %}
  <section id="recent-blogs" class="blogs-section" aria-label="Recent Blog Posts">
    {% section 'recent-blogs' %}
  </section>
  
  {% comment %} Brand Partners Section {% endcomment %}
  <section id="brand-partners" class="partners-section" aria-label="Brand Partners">
    {% section 'brand-partners' %}
  </section>
  
</main>

{% comment %} Back to Top Button {% endcomment %}
<button id="back-to-top" class="back-to-top-btn" aria-label="Back to top" title="Back to top">
  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M7 14L12 9L17 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
</button>

{% comment %} Inline JavaScript for Critical Functionality {% endcomment %}
<script>
  // Critical JavaScript for immediate functionality
  document.addEventListener('DOMContentLoaded', function() {
    // Back to top button functionality
    const backToTopBtn = document.getElementById('back-to-top');
    
    window.addEventListener('scroll', function() {
      if (window.pageYOffset > 300) {
        backToTopBtn.classList.add('visible');
      } else {
        backToTopBtn.classList.remove('visible');
      }
    });
    
    backToTopBtn.addEventListener('click', function() {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    });
    
    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });
    
    // Lazy loading images
    if ('IntersectionObserver' in window) {
      const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const img = entry.target;
            img.src = img.dataset.src;
            img.classList.remove('lazy');
            imageObserver.unobserve(img);
          }
        });
      });
      
      document.querySelectorAll('img[data-src]').forEach(img => {
        imageObserver.observe(img);
      });
    }
  });
  
  // Performance monitoring
  window.addEventListener('load', function() {
    // Track page load time
    const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
    
    // Send to analytics if available
    if (typeof gtag !== 'undefined') {
      gtag('event', 'page_load_time', {
        'event_category': 'Performance',
        'event_label': 'Homepage',
        'value': Math.round(loadTime)
      });
    }
  });
</script>

{% comment %} Schema Markup for Homepage Products {% endcomment %}
{% if collections.featured-products.products.size > 0 %}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "ItemList",
    "name": "Featured Products",
    "description": "Featured health and fitness products",
    "numberOfItems": {{ collections.featured-products.products.size }},
    "itemListElement": [
      {% for product in collections.featured-products.products limit: 10 %}
        {
          "@type": "Product",
          "position": {{ forloop.index }},
          "name": "{{ product.title | escape }}",
          "description": "{{ product.description | strip_html | truncate: 160 | escape }}",
          "image": "{{ product.featured_image | img_url: '800x800' }}",
          "url": "{{ shop.url }}{{ product.url }}",
          "brand": {
            "@type": "Brand",
            "name": "{{ product.vendor | escape }}"
          },
          "offers": {
            "@type": "Offer",
            "price": "{{ product.price | money_without_currency }}",
            "priceCurrency": "{{ shop.currency }}",
            "availability": "{% if product.available %}https://schema.org/InStock{% else %}https://schema.org/OutOfStock{% endif %}",
            "url": "{{ shop.url }}{{ product.url }}"
          }
        }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ]
  }
  </script>
{% endif %}

{% comment %} Error Handling for Missing Sections {% endcomment %}
<script>
  // Check if critical sections are loaded
  document.addEventListener('DOMContentLoaded', function() {
    const criticalSections = [
      'hero-carousel',
      'product-categories',
      'featured-products'
    ];
    
    criticalSections.forEach(sectionId => {
      const section = document.getElementById(sectionId);
      if (!section) {
        console.warn(`Critical section ${sectionId} not found`);
      }
    });
  });
{% comment %}

  Homepage Template
  Main template for the homepage that includes all the key sections
{% endcomment %}

{% section 'hero' %}

{% section 'category-grid' %}

{% section 'featured-products' %}

{% section 'newsletter-signup' %}

{% section 'testimonials' %}

{% section 'brand-story' %}

{% section 'instagram-feed' %}

{% comment %}
  Homepage template - RecoverSups Theme
  This template uses sections that can be customized through the theme editor
  Schema configuration is handled by individual sections and index.json
{% endcomment %}