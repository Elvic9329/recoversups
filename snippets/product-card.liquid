{% comment %}
  RecoverSups Product Card Component
  Reusable product card with CSS Grid layout and advanced features
  
  Parameters:
  - product: Product object (required)
  - show_description: Boolean to show/hide description (default: true)
  - show_quick_view: Boolean to show/hide quick view button (default: true)
  - card_size: String ('sm', 'md', 'lg') for card sizing (default: 'md')
  - image_aspect_ratio: String ('square', 'portrait', 'landscape') (default: 'square')
{% endcomment %}

{% assign show_description = show_description | default: true %}
{% assign show_quick_view = show_quick_view | default: true %}
{% assign card_size = card_size | default: 'md' %}
{% assign image_aspect_ratio = image_aspect_ratio | default: 'square' %}

<div class="product-card product-card--{{ card_size }}" data-product-id="{{ product.id }}">
  <!-- Product Image Container -->
  <div class="product-card-image product-card-image--{{ image_aspect_ratio }}">
    {% if product.featured_image %}
      <a href="{{ product.url }}" class="product-card-image-link">
        <img 
          src="{{ product.featured_image | img_url: '600x600' }}" 
          alt="{{ product.featured_image.alt | default: product.title }}"
          class="product-card-image-main"
          loading="lazy"
        >
        {% if product.images.size > 1 %}
          <img 
            src="{{ product.images[1] | img_url: '600x600' }}" 
            alt="{{ product.images[1].alt | default: product.title }}"
            class="product-card-image-hover"
            loading="lazy"
          >
        {% endif %}
      </a>
    {% else %}
      <div class="product-card-image-placeholder">
        <svg class="product-card-image-placeholder-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
          <circle cx="8.5" cy="8.5" r="1.5"/>
          <polyline points="21,15 16,10 5,21"/>
        </svg>
      </div>
    {% endif %}

    <!-- Product Badges -->
    <div class="product-card-badges">
      {% if product.compare_at_price > product.price %}
        <div class="product-card-badge product-card-badge--sale">
          {% assign discount = product.compare_at_price | minus: product.price %}
          {% assign discount_percent = discount | times: 100 | divided_by: product.compare_at_price %}
          -{{ discount_percent }}%
        </div>
      {% endif %}
      
      {% if product.tags contains 'new' %}
        <div class="product-card-badge product-card-badge--new">New</div>
      {% endif %}
      
      {% if product.tags contains 'bestseller' %}
        <div class="product-card-badge product-card-badge--bestseller">Bestseller</div>
      {% endif %}
    </div>

    <!-- Quick Actions -->
    <div class="product-card-actions">
      {% if show_quick_view %}
        <button 
          class="product-card-action product-card-action--quick-view"
          data-product-handle="{{ product.handle }}"
          aria-label="Quick view {{ product.title }}"
        >
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
            <circle cx="12" cy="12" r="3"/>
          </svg>
        </button>
      {% endif %}
      
      <button 
        class="product-card-action product-card-action--wishlist"
        data-product-id="{{ product.id }}"
        aria-label="Add {{ product.title }} to wishlist"
      >
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Product Info -->
  <div class="product-card-info">
    <!-- Product Title -->
    <h3 class="product-card-title">
      <a href="{{ product.url }}" class="product-card-title-link">
        {{ product.title }}
      </a>
    </h3>

    <!-- Product Description -->
    {% if show_description and product.description != blank %}
      <p class="product-card-description">
        {{ product.description | strip_html | truncate: 120 }}
      </p>
    {% endif %}

    <!-- Product Vendor -->
    {% if product.vendor != blank %}
      <div class="product-card-vendor">
        {{ product.vendor }}
      </div>
    {% endif %}

    <!-- Product Price -->
    <div class="product-card-price">
      {% if product.compare_at_price > product.price %}
        <span class="product-card-price-current">
          {{ product.price | money }}
        </span>
        <span class="product-card-price-compare">
          {{ product.compare_at_price | money }}
        </span>
      {% else %}
        <span class="product-card-price-current">
          {{ product.price | money }}
        </span>
      {% endif %}
    </div>

    <!-- Product Variants (if multiple options) -->
    {% if product.variants.size > 1 %}
      <div class="product-card-variants">
        {% for option in product.options_with_values %}
          {% if option.name == 'Color' or option.name == 'Flavor' %}
            <div class="product-card-variant-option">
              <span class="product-card-variant-label">{{ option.name }}:</span>
              <div class="product-card-variant-values">
                {% for value in option.values limit: 5 %}
                  <span class="product-card-variant-value">{{ value }}</span>
                {% endfor %}
                {% if option.values.size > 5 %}
                  <span class="product-card-variant-more">+{{ option.values.size | minus: 5 }}</span>
                {% endif %}
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div>
    {% endif %}

    <!-- Add to Cart Form -->
    <div class="product-card-cart">
      {% if product.available %}
        <form class="product-card-form" action="/cart/add" method="post" enctype="multipart/form-data">
          <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
          
          {% if product.variants.size > 1 %}
            <div class="product-card-variant-selector">
              <select name="id" class="product-card-variant-select">
                {% for variant in product.variants %}
                  <option 
                    value="{{ variant.id }}" 
                    {% unless variant.available %}disabled{% endunless %}
                    data-price="{{ variant.price | money }}"
                    data-compare-price="{% if variant.compare_at_price > variant.price %}{{ variant.compare_at_price | money }}{% endif %}"
                  >
                    {{ variant.title }}
                    {% unless variant.available %} - Sold Out{% endunless %}
                  </option>
                {% endfor %}
              </select>
            </div>
          {% endif %}
          
          <button 
            type="submit" 
            class="product-card-add-to-cart"
            {% unless product.available %}disabled{% endunless %}
          >
            <span class="product-card-add-to-cart-text">Add to Cart</span>
            <span class="product-card-add-to-cart-loading">Adding...</span>
            <span class="product-card-add-to-cart-success">Added!</span>
          </button>
        </form>
      {% else %}
        <button class="product-card-add-to-cart product-card-add-to-cart--disabled" disabled>
          Sold Out
        </button>
      {% endif %}
    </div>
  </div>
</div>