{% comment %}
  Certification Badges Component - RecoverSups Theme
  
  Description: Displays product certifications and quality badges
  
  Parameters:
    - product: Product object (required)
    - certifications: Array of certifications (optional, overrides metafields)
    - layout: Display layout (badges|list|compact) (default: badges)
    - show_descriptions: Show certification descriptions (default: false)
    - max_badges: Maximum number of badges to show
  
  Usage:
    {% render 'certification-badges', product: product %}
    {% render 'certification-badges', product: product, layout: 'list', show_descriptions: true %}
  
  Metafields Expected:
    - product.metafields.certifications.list (JSON array)
    
  Example metafield structure:
    [
      {
        "name": "NSF Certified",
        "code": "nsf",
        "description": "Third-party tested for sport",
        "image": "nsf-logo.png",
        "url": "https://nsf.org"
      },
      {
        "name": "GMP Certified",
        "code": "gmp",
        "description": "Good Manufacturing Practices",
        "verified": true
      }
    ]
  
  Dependencies:
    - CSS: component-certification-badges.css
{% endcomment %}

{% liquid
  assign certifications = certifications | default: product.metafields.certifications.list.value
  assign layout = layout | default: 'badges'
  assign show_descriptions = show_descriptions | default: false
  assign max_badges = max_badges | default: 6
%}

{% if certifications and certifications.size > 0 %}
<div class="certification-badges certification-badges--{{ layout }}" data-certification-badges>
  
  {% if layout == 'badges' %}
    <div class="certification-badges__grid">
      {% for cert in certifications limit: max_badges %}
        <div class="certification-badge" 
             data-certification="{{ cert.code | handle }}"
             {% if cert.url %}data-url="{{ cert.url }}"{% endif %}>
          
          {% if cert.image %}
            <div class="certification-badge__image">
              <img src="{{ cert.image | asset_url }}" 
                   alt="{{ cert.name | escape }}" 
                   loading="lazy"
                   width="60" 
                   height="60">
            </div>
          {% else %}
            <div class="certification-badge__icon">
              {% render 'certification-icon-svg', code: cert.code %}
            </div>
          {% endif %}
          
          <div class="certification-badge__content">
            <h3 class="certification-badge__name">{{ cert.name }}</h3>
            {% if show_descriptions and cert.description %}
              <p class="certification-badge__description">{{ cert.description }}</p>
            {% endif %}
            {% if cert.verified %}
              <div class="certification-badge__verified">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                  <path d="M9 12l2 2 4-4"/>
                </svg>
                <span>Verified</span>
              </div>
            {% endif %}
          </div>
          
          {% if cert.url %}
            <a href="{{ cert.url }}" 
               class="certification-badge__link" 
               target="_blank" 
               rel="noopener noreferrer"
               aria-label="Learn more about {{ cert.name }}">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                <polyline points="15,3 21,3 21,9"/>
                <line x1="10" y1="14" x2="21" y2="3"/>
              </svg>
            </a>
          {% endif %}
        </div>
      {% endfor %}
    </div>
    
  {% elsif layout == 'list' %}
    <div class="certification-badges__list">
      {% for cert in certifications limit: max_badges %}
        <div class="certification-item" data-certification="{{ cert.code | handle }}">
          
          {% if cert.image %}
            <div class="certification-item__image">
              <img src="{{ cert.image | asset_url }}" 
                   alt="{{ cert.name | escape }}" 
                   loading="lazy"
                   width="40" 
                   height="40">
            </div>
          {% else %}
            <div class="certification-item__icon">
              {% render 'certification-icon-svg', code: cert.code %}
            </div>
          {% endif %}
          
          <div class="certification-item__content">
            <h3 class="certification-item__name">
              {{ cert.name }}
              {% if cert.verified %}
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="certification-verified-icon" aria-hidden="true">
                  <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                  <path d="M9 12l2 2 4-4"/>
                </svg>
              {% endif %}
            </h3>
            {% if show_descriptions and cert.description %}
              <p class="certification-item__description">{{ cert.description }}</p>
            {% endif %}
          </div>
          
          {% if cert.url %}
            <a href="{{ cert.url }}" 
               class="certification-item__link" 
               target="_blank" 
               rel="noopener noreferrer"
               aria-label="Learn more about {{ cert.name }}">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                <polyline points="15,3 21,3 21,9"/>
                <line x1="10" y1="14" x2="21" y2="3"/>
              </svg>
            </a>
          {% endif %}
        </div>
      {% endfor %}
    </div>
    
  {% elsif layout == 'compact' %}
    <div class="certification-badges__compact">
      {% for cert in certifications limit: max_badges %}
        <div class="certification-compact" 
             data-certification="{{ cert.code | handle }}"
             title="{{ cert.description | escape }}">
          
          {% if cert.image %}
            <img src="{{ cert.image | asset_url }}" 
                 alt="{{ cert.name | escape }}" 
                 loading="lazy"
                 width="32" 
                 height="32"
                 class="certification-compact__image">
          {% else %}
            <div class="certification-compact__icon">
              {% render 'certification-icon-svg', code: cert.code %}
            </div>
          {% endif %}
          
          {% if cert.verified %}
            <div class="certification-compact__verified">
              <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" aria-hidden="true">
                <path d="M9 12l2 2 4-4"/>
              </svg>
            </div>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% endif %}
  
</div>

<!-- Schema.org structured data for certifications -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Product",
  "name": "{{ product.title | escape }}",
  "certifications": [
    {% for cert in certifications %}
      {
        "@type": "Certification",
        "name": "{{ cert.name | escape }}",
        {% if cert.description %}"description": "{{ cert.description | escape }}",{% endif %}
        {% if cert.url %}"url": "{{ cert.url }}",{% endif %}
        "issuedBy": "{{ cert.issuer | default: cert.name | escape }}"
      }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ]
}
</script>

{% endif %}

{% comment %}
  Certification Icon SVG Renderer
  Internal snippet for rendering certification icons
{% endcomment %}
{% if certification_icon_svg_code %}
  {% liquid
    assign code = certification_icon_svg_code | default: 'default'
  %}
  
  {% case code %}
    {% when 'nsf' %}
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="certification-icon-svg" aria-hidden="true">
        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
        <path d="M9 12l2 2 4-4"/>
      </svg>
      
    {% when 'gmp' %}
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="certification-icon-svg" aria-hidden="true">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
        <polyline points="14,2 14,8 20,8"/>
        <line x1="16" y1="13" x2="8" y2="13"/>
        <line x1="16" y1="17" x2="8" y2="17"/>
        <polyline points="10,9 9,9 8,9"/>
      </svg>
      
    {% when 'usda-organic' %}
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="certification-icon-svg" aria-hidden="true">
        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        <circle cx="12" cy="12" r="3"/>
      </svg>
      
    {% when 'fda' %}
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="certification-icon-svg" aria-hidden="true">
        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
        <circle cx="9" cy="9" r="2"/>
        <path d="M21 15.5c-2.5-3.5-7-3.5-9.5 0"/>
        <path d="M3.5 15.5c2.5-3.5 7-3.5 9.5 0"/>
      </svg>
      
    {% when 'third-party-tested' %}
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="certification-icon-svg" aria-hidden="true">
        <path d="M9 11l3 3 8-8"/>
        <path d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9c2.35 0 4.48.9 6.08 2.38"/>
      </svg>
      
    {% when 'gluten-free' %}
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="certification-icon-svg" aria-hidden="true">
        <path d="M18 6L6 18"/>
        <path d="M6 6l12 12"/>
        <circle cx="12" cy="12" r="10"/>
      </svg>
      
    {% when 'vegan' %}
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="certification-icon-svg" aria-hidden="true">
        <path d="M7 20s4-9 6-9 6 9 6 9"/>
        <path d="M9 16c.85-.63 1.885-1 3-1s2.15.37 3 1"/>
        <path d="M12 2C8.5 2 8.5 9 12 9s3.5-7 0-7"/>
      </svg>
      
    {% else %}
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="certification-icon-svg" aria-hidden="true">
        <circle cx="12" cy="12" r="10"/>
        <path d="M9 12l2 2 4-4"/>
      </svg>
  {% endcase %}
{% endif %}