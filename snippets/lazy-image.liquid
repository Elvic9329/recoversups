{%- comment -%}
  RecoverSups Lazy Loading Image Snippet
  
  Usage:
  {% render 'lazy-image', 
     image: product.featured_image, 
     alt: product.title,
     class: 'product-image',
     aspect_ratio: '16-9',
     sizes: '(min-width: 768px) 50vw, 100vw' %}
{%- endcomment -%}

{%- liquid
  assign aspect_ratio = aspect_ratio | default: '16-9'
  assign sizes = sizes | default: '100vw'
  assign loading = loading | default: 'lazy'
  assign class = class | default: ''
  assign placeholder_class = 'lazy-image-placeholder ratio-' | append: aspect_ratio
  
  if class != blank
    assign placeholder_class = placeholder_class | append: ' ' | append: class
  endif
  
  if image
    assign alt_text = alt | default: image.alt | default: 'Imagen de producto'
    assign image_width = image.width | default: 800
    assign image_height = image.height | default: 600
  else
    assign alt_text = alt | default: 'Imagen no disponible'
    assign image_width = 800
    assign image_height = 600
  endif
-%}

<div class="{{ placeholder_class }}">
  {%- if image -%}
    <img
      data-src="{{ image | image_url: width: image_width }}"
      data-srcset="
        {{ image | image_url: width: 400 }} 400w,
        {{ image | image_url: width: 600 }} 600w,
        {{ image | image_url: width: 800 }} 800w,
        {{ image | image_url: width: 1200 }} 1200w
      "
      sizes="{{ sizes }}"
      alt="{{ alt_text | escape }}"
      loading="{{ loading }}"
      width="{{ image_width }}"
      height="{{ image_height }}"
      class="lazy-loading"
    >
  {%- else -%}
    {%- comment -%} Placeholder for missing images {%- endcomment -%}
    <div class="lazy-image-placeholder no-image" 
         style="display: flex; align-items: center; justify-content: center; background-color: #e2e8f0; color: #718096;">
      <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
        <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>
      </svg>
    </div>
  {%- endif -%}
</div>

{%- comment -%}
  Example usage in templates:
  
  <!-- Product image with lazy loading -->
  {% render 'lazy-image', 
     image: product.featured_image, 
     alt: product.title,
     class: 'product-featured-image',
     aspect_ratio: '1-1',
     sizes: '(min-width: 1024px) 33vw, (min-width: 768px) 50vw, 100vw' %}
  
  <!-- Collection image -->
  {% render 'lazy-image', 
     image: collection.featured_image, 
     alt: collection.title,
     class: 'collection-hero-image',
     aspect_ratio: '16-9',
     sizes: '100vw' %}
  
  <!-- Article image -->
  {% render 'lazy-image', 
     image: article.image, 
     alt: article.title,
     class: 'article-featured-image',
     aspect_ratio: '3-2',
     sizes: '(min-width: 768px) 60vw, 100vw' %}
{%- endcomment -%}